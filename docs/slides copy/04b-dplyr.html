<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>dplyr</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles_xa.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

# dplyr
## A package tailed towards the manipulation of data frames
### 

---




---

# dyplyr

- [`dplyr`](https://dplyr.tidyverse.org/) is a package tailed towards data manipulation.

--

- `filter()` picks cases based on their values.

--

- `select()` picks variables based on their names.

--

- `mutate()` adds new variables that are functions of existing variables

--

- `summarise()` reduces multiple values down to a single summary.

--

- `group_by()` allows to perform any operation by grouping variables.

--

- `arrange()` changes the ordering of the rows.

---

# `filter()` picks cases based on their values

`filter(.data, ...)` 


```r
# Without %&gt;%:
filter(mtcars, disp &gt; 350 &amp; mpg &lt; 11)

# with %&gt;%
mtcars %&gt;%
  filter(disp &gt; 350 &amp; mpg &lt; 11)
```

Note: You don't have to provide the name of a data object within the dplyr function!

***not***: `filter(mtcars, mtcars$disp &gt; 350 &amp; mtcars$mpg &lt; 11)`

***but***: `filter(mtcars, disp &gt; 350 &amp; mpg &lt; 11)`

---

# Task

- Take the `starwars` database.
- Filter all cases with `brown` hair color and `female` gender (Hint: variables `hair_color` and `sex`)

&lt;div class="red2"&gt;**Please stop the video here! Continue after completing the task!**&lt;/div&gt;

---


```r
library(tidyverse)
starwars %&gt;% 
  filter(hair_color == "brown" &amp; sex == "female")
```

```
## # A tibble: 6 x 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Leia Org…    150    49 brown      light      brown             19 fema… femin…
## 2 Beru Whi…    165    75 brown      light      blue              47 fema… femin…
## 3 Cordé        157    NA brown      light      brown             NA fema… femin…
## 4 Dormé        165    NA brown      light      brown             NA fema… femin…
## 5 Rey           NA    NA brown      light      hazel             NA fema… femin…
## 6 Padmé Am…    165    45 brown      light      brown             46 fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# `select()` picks variables based on their names

`select(.data, ...)` 


```r
# Either column numbers or column names
mtcars %&gt;% select(1, 3, carb)
# Use the `:` symbol for ranges
mtcars %&gt;% select(1:3, am:carb)
# use `-` to drop variables and keep the others
mtcars %&gt;% select(-am, -(1:3), -(disp:drat))
```

`starts_with()` and `ends_with()` can be used to select variables by parts of their names:


```r
mtcars %&gt;% select(starts_with("d"))
mtcars %&gt;% select(-ends_with("b"))
```

---

# Task

- Take the `starwars` database.
- Filter for `Human` and select the variables `name, height, and mass` (Hint: variable `species`)

&lt;div class="red2"&gt;**Please stop the video here! Continue after completing the task!**&lt;/div&gt;

---


```r
starwars %&gt;% 
  filter(species == "Human") %&gt;% 
  select(name:mass)
```

```
## # A tibble: 35 x 3
##    name               height  mass
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt;
##  1 Luke Skywalker        172    77
##  2 Darth Vader           202   136
##  3 Leia Organa           150    49
##  4 Owen Lars             178   120
##  5 Beru Whitesun lars    165    75
##  6 Biggs Darklighter     183    84
##  7 Obi-Wan Kenobi        182    77
##  8 Anakin Skywalker      188    84
##  9 Wilhuff Tarkin        180    NA
## 10 Han Solo              180    80
## # … with 25 more rows
```

---

# relocate() changes the column order

The `relocate()` function helps to rearrange the columns of a data frame 


```r
starwars %&gt;% 
  relocate(name, birth_year, sex)
```

```
## # A tibble: 87 x 14
##    name    birth_year sex    height  mass hair_color skin_color eye_color gender
##    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt; 
##  1 Luke S…       19   male      172    77 blond      fair       blue      mascu…
##  2 C-3PO        112   none      167    75 &lt;NA&gt;       gold       yellow    mascu…
##  3 R2-D2         33   none       96    32 &lt;NA&gt;       white, bl… red       mascu…
##  4 Darth …       41.9 male      202   136 none       white      yellow    mascu…
##  5 Leia O…       19   female    150    49 brown      light      brown     femin…
##  6 Owen L…       52   male      178   120 brown, gr… light      blue      mascu…
##  7 Beru W…       47   female    165    75 brown      light      blue      femin…
##  8 R5-D4         NA   none       97    32 &lt;NA&gt;       white, red red       mascu…
##  9 Biggs …       24   male      183    84 black      light      brown     mascu…
## 10 Obi-Wa…       57   male      182    77 auburn, w… fair       blue-gray mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# `mutate()` adds new variables that are functions of existing variables

`mutate(.data, ...)`


```r
mtcars %&gt;%
  mutate(
    efficiency = mpg / disp,
    effect = round(hp / mpg * 100)
  )
```

```
##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
##                     efficiency effect
## Mazda RX4           0.13125000    524
## Mazda RX4 Wag       0.13125000    524
## Datsun 710          0.21111111    408
## Hornet 4 Drive      0.08294574    514
## Hornet Sportabout   0.05194444    936
## Valiant             0.08044444    580
## Duster 360          0.03972222   1713
## Merc 240D           0.16632584    254
## Merc 230            0.16193182    417
## Merc 280            0.11455847    641
## Merc 280C           0.10620525    691
## Merc 450SE          0.05946338   1098
## Merc 450SL          0.06272661   1040
## Merc 450SLC         0.05511240   1184
## Cadillac Fleetwood  0.02203390   1971
## Lincoln Continental 0.02260870   2067
## Chrysler Imperial   0.03340909   1565
## Fiat 128            0.41168996    204
## Honda Civic         0.40158520    171
## Toyota Corolla      0.47679325    192
## Toyota Corona       0.17901749    451
## Dodge Challenger    0.04874214    968
## AMC Javelin         0.05000000    987
## Camaro Z28          0.03800000   1842
## Pontiac Firebird    0.04800000    911
## Fiat X1-9           0.34556962    242
## Porsche 914-2       0.21612635    350
## Lotus Europa        0.31966351    372
## Ford Pantera L      0.04501425   1671
## Ferrari Dino        0.13586207    888
## Maserati Bora       0.04983389   2233
## Volvo 142E          0.17685950    509
```

---

# Task

- Take the `starwars` database.
- Create a new variable with the body mass index `bmi`. Hint: bmi = kg / m²
- Filter all humans with an bmi &gt;= 26.
- Select `name, bmi, height, and mass`

&lt;div class="red2"&gt;**Please stop the video here! Continue after completing the task!**&lt;/div&gt;

---


```r
starwars %&gt;%
  mutate(bmi = mass/ (height/100)^2) %&gt;%
  filter(bmi &gt;= 26 &amp; species == "Human") %&gt;%
  select(name, bmi, height, mass)
```

```
## # A tibble: 6 x 4
##   name                 bmi height  mass
##   &lt;chr&gt;              &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
## 1 Luke Skywalker      26.0    172    77
## 2 Darth Vader         33.3    202   136
## 3 Owen Lars           37.9    178   120
## 4 Beru Whitesun lars  27.5    165    75
## 5 Wedge Antilles      26.6    170    77
## 6 Jek Tono Porkins    34.0    180   110
```

---

# `summarise()` reduces multiple values down to a single summary.


```r
mtcars %&gt;%
  summarise(
    mean_mpg = mean(mpg),
    sd_mpg = sd(mpg),
    n = n()
  )
```

```
##   mean_mpg   sd_mpg  n
## 1 20.09062 6.026948 32
```

---

# Task

- Take the `starwars` database.
- Filter `Humans`
- Calculate the mean and the median for height and mass (Note: don't forget to remove NA values: `na.rm = TRUE`)

&lt;div class="red2"&gt;**Please stop the video here! Continue after completing the task!**&lt;/div&gt;

--- 


```r
starwars %&gt;%
  filter(species == "Human") %&gt;%
  summarise(
    mean_height = mean(height, na.rm = TRUE),
    median_height = median(height, na.rm = TRUE),
    mean_mass = mean(mass, na.rm = TRUE),
    median_mass = median(mass, na.rm = TRUE)
  )
```

```
## # A tibble: 1 x 4
##   mean_height median_height mean_mass median_mass
##         &lt;dbl&gt;         &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1        177.           180      82.8          79
```

---

# `group_by()` allows to perform any operation by grouping variables.


```r
mtcars %&gt;% group_by(cyl) %&gt;%
  summarise(
    mean_mpg = mean(mpg),
    sd_mpg = sd(mpg),
    n = n()
  )
```

```
## # A tibble: 3 x 4
##     cyl mean_mpg sd_mpg     n
##   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1     4     26.7   4.51    11
## 2     6     19.7   1.45     7
## 3     8     15.1   2.56    14
```

--- 


```r
mtcars %&gt;% group_by(cyl, am) %&gt;%
  summarise(
    mean_mpg = mean(mpg),
    sd_mpg = sd(mpg),
    n = n()
  )
```

```
## # A tibble: 6 x 5
## # Groups:   cyl [3]
##     cyl    am mean_mpg sd_mpg     n
##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1     4     0     22.9  1.45      3
## 2     4     1     28.1  4.48      8
## 3     6     0     19.1  1.63      4
## 4     6     1     20.6  0.751     3
## 5     8     0     15.0  2.77     12
## 6     8     1     15.4  0.566     2
```

---

# Task

- Take the `starwars` database.
- Group by sex
- Calculate the median for height and mass
- And the number of cases per group (Hint: `n()`)

&lt;div class="red2"&gt;**Please stop the video here! Continue after completing the task!**&lt;/div&gt;

---


```r
starwars %&gt;%
  group_by(sex) %&gt;%
  summarise(
    median_height = median(height, na.rm = TRUE),
    median_mass = median(mass, na.rm = TRUE),
    n = n()
  )
```

```
## # A tibble: 5 x 4
##   sex            median_height median_mass     n
##   &lt;chr&gt;                  &lt;int&gt;       &lt;dbl&gt; &lt;int&gt;
## 1 female                   166        55      16
## 2 hermaphroditic           175      1358       1
## 3 male                     183        80      60
## 4 none                      97        53.5     6
## 5 &lt;NA&gt;                     183        48       4
```

---

# `arrange()` changes the ordering of the rows

`arrange(.data, ...)`


```r
dat &lt;- data.frame(age = c(5,5,6,7,6), sen = c(0, 1, 1, 0, 0), points = c(34, 55, 22, 11, 9))
dat %&gt;%
  arrange(sen, age) 
```

```
##   age sen points
## 1   5   0     34
## 2   6   0      9
## 3   7   0     11
## 4   5   1     55
## 5   6   1     22
```

---

# `desc()` specifies a variable to be arranged descending


```r
dat %&gt;%
  arrange(sen, desc(points))
```

```
##   age sen points
## 1   5   0     34
## 2   7   0     11
## 3   6   0      9
## 4   5   1     55
## 5   6   1     22
```

---

# Task

- Take the `starwars` database.
- Calculate the bmi.
- Summarize the median of the bmi grouped by species.
- round the bmi to one decimal.
- Also calculate the `n` for each group.
- Only show cases with `n &gt; 2`.
- Arrange the resulting table. Sort by `n` in descending order.

&lt;div class="red2"&gt;**Please stop the video here! Continue after completing the task!**&lt;/div&gt;

--- 


```r
starwars %&gt;% 
  mutate(bmi = mass / (height / 100)^2) %&gt;% 
  group_by(species) %&gt;% 
  summarise(
    mean_bmi = median(bmi, na.rm = TRUE) %&gt;% round(1), 
    n = n()
  ) %&gt;%
  filter(n &gt;2) %&gt;%
  arrange(desc(n))
```

```
## # A tibble: 4 x 3
##   species mean_bmi     n
##   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 Human       24.8    35
## 2 Droid       34.4     6
## 3 &lt;NA&gt;        15.1     4
## 4 Gungan      16.8     3
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:10"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
